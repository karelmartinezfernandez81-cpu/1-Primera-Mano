<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Primera Mano ‚Äì Cat√°logo</title>

  <!-- Iconos -->
  <script src="https://kit.fontawesome.com/a076d05399.js" crossorigin="anonymous"></script>

  <!-- Estilos (limpios y embebidos para facilitar) -->
  <style>
    :root{
      --gold: #d4af37;
      --dark: #0b0b0b;
      --muted-black: rgba(0,0,0,0.75);
      --glass: rgba(255,255,255,0.9);
    }

    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: "Poppins", sans-serif;
      background: linear-gradient(rgba(0,0,0,0.3), rgba(0,0,0,0.3)), url('fondo1.png') center/cover fixed no-repeat;
      color:#fff;
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
    }

    header{
      text-align:center;
      padding:22px 12px;
      background: linear-gradient(90deg, #000, #120b00, #000);
      border-bottom: 2px solid var(--gold);
      box-shadow: 0 0 20px rgba(212,175,55,0.2);
      position: sticky;
      top: 0;
      z-index: 1200;
    }
    header h1{ margin:0; font-size:1.6rem; color:var(--gold); letter-spacing:1px;}
    header p{ margin:6px 0 0; color:var(--gold); font-size:0.95rem; }

    nav.topnav{
      display:flex;
      justify-content:center;
      gap:18px;
      padding:10px 8px;
      background: linear-gradient(90deg, rgba(0,0,0,0.9), rgba(10,10,10,0.9));
      border-bottom:1px solid rgba(212,175,55,0.15);
      position: sticky;
      top: 72px;
      z-index: 1100;
    }
    nav.topnav a{
      color:var(--gold);
      text-decoration:none;
      font-weight:700;
      padding:6px 10px;
      border-radius:6px;
    }
    nav.topnav a:hover{ background:linear-gradient(90deg,var(--gold),#b8921b); color:#000; transform:scale(1.03); }

    .container{ max-width:1200px; margin: 30px auto; padding: 0 14px; }

    .seccion-productos{
      background: rgba(0,0,0,0.55);
      border-radius: 16px;
      padding: 22px;
      margin-bottom: 28px;
      box-shadow: 0 6px 18px rgba(0,0,0,0.45);
    }
    .titulo-oro{ color: var(--gold); font-size:1.8rem; text-align:center; margin:6px 0 18px;}

    .galeria{
      display:grid;
      grid-template-columns: repeat(auto-fit, minmax(240px,1fr));
      gap:18px;
    }

    .producto{
      background: rgba(0,0,0,0.85);
      border: 1px solid var(--gold);
      border-radius: 14px;
      padding: 12px;
      text-align:center;
      color: #fff;
      min-height: 360px;
      display:flex;
      flex-direction:column;
      gap:8px;
      position:relative;
    }
    .producto.agotado{ opacity:0.6; pointer-events:none; }
    .producto img{ width:100%; height:180px; object-fit:cover; border-radius:8px; border:1px solid rgba(255,255,255,0.06); }
    .producto h3{ margin:6px 0 0; color:var(--gold); font-size:1.05rem; }
    .producto p{ margin:4px 0; color:#fff; font-size:0.95rem; }
    .precio{ color:#fff; font-weight:700; }

    .selector-precio, .boton-carrito, .producto button{
      width:100%;
      padding:10px;
      border-radius:8px;
      border: none;
      cursor:pointer;
      font-weight:700;
    }
    .selector-precio{
      background:#000; color:var(--gold); border:2px solid var(--gold); text-align:center;
    }
    .boton-carrito{
      background:var(--gold); color:#000; margin-top:auto;
    }
    .boton-carrito:disabled{ opacity:0.5; cursor:not-allowed; }

    /* carrito flotante/panel */
    .cart-toggle{
      position:fixed;
      right:20px;
      bottom:100px;
      z-index:1200;
      background:var(--gold);
      color:#000;
      border-radius:50%;
      width:56px; height:56px;
      display:flex; align-items:center; justify-content:center;
      box-shadow:0 6px 18px rgba(0,0,0,0.4);
      cursor:pointer;
      border:none;
      font-size:1.2rem;
    }

    #carrito-panel{
      position:fixed;
      right:20px;
      bottom:20px;
      width:320px;
      max-height:75vh;
      overflow:auto;
      background: var(--glass);
      color:#000;
      border-radius:12px;
      box-shadow:0 12px 40px rgba(0,0,0,0.5);
      padding:12px;
      z-index:1199;
    }
    #carrito-panel h2{ margin:0 0 8px; color:var(--gold); text-align:center; }
    #lista-carrito{ list-style:none; padding:0; margin:0 0 8px; }
    #lista-carrito li{ display:flex; justify-content:space-between; gap:8px; align-items:center; padding:6px 4px; border-bottom:1px dashed rgba(0,0,0,0.1); }
    #lista-carrito li button{ background:transparent; border:none; cursor:pointer; color:#900; font-size:1rem; }

    #total{ text-align:right; font-weight:800; margin:8px 0; color:#000; }

    #carrito-panel .panel-actions{ display:flex; gap:8px; }
    #carrito-panel .panel-actions button{ flex:1; padding:10px; border-radius:8px; border:none; cursor:pointer; font-weight:700; }
    .btn-vaciar{ background:#e74c3c; color:#fff; }
    .btn-whatsapp{ background:#25d366; color:#fff; }

    footer{ text-align:center; padding:18px; color:var(--gold); margin-top:30px; }

    @media (max-width: 720px){
      #carrito-panel{ right:10px; left:10px; width:auto; }
      .cart-toggle{ bottom:80px; right:12px; }
    }
  </style>
</head>
<body>
  <header>
    <h1>PRIMERA MANO</h1>
    <p>Cat√°logo Premium ‚Äî Negro & Dorado</p>
  </header>

  <nav class="topnav">
    <a href="#electrodomesticos">Electrodom√©sticos</a>
    <a href="#combo">Combo y Remesa</a>
    <a href="#camas">Muebles / Camas</a>
    <a href="#contacto">Contacto</a>
  </nav>

  <main class="container">
    <!-- Electrodom√©sticos -->
    <section id="electrodomesticos" class="seccion-productos" data-categoria="Electrodom√©sticos">
      <h2 class="titulo-oro">‚ö° Electrodom√©sticos</h2>
      <div class="galeria">
        <div class="producto">
          <img src="electrodomesticos/electro1.jpg" alt="Air Fryer Royal 4L" loading="lazy">
          <h3>Air Fryer Royal 4L</h3>
          <p class="precio">üíµ $55</p>
          <button class="boton-carrito">Agregar üõí</button>
        </div>

        <div class="producto">
          <img src="electrodomesticos/electro2.jpg" alt="Televisor ROYAL 32‚Äù Smart" loading="lazy">
          <h3>Televisor ROYAL 32‚Äù Smart</h3>
          <p class="precio">üíµ $155</p>
          <button class="boton-carrito">Agregar üõí</button>
        </div>

        <div class="producto">
          <img src="electrodomesticos/electro3.jpg" alt="Cocina de Keroseno BigWheel" loading="lazy">
          <h3>Cocina de Keroseno BigWheel</h3>
          <p class="precio">üíµ $36</p>
          <button class="boton-carrito">Agregar üõí</button>
        </div>

        <div class="producto">
          <img src="electrodomesticos/electro4.jpg" alt="Bomba de agua SP-QB60" loading="lazy">
          <h3>Bomba de Agua 1/2 HP</h3>
          <p class="precio">üíµ $36</p>
          <button class="boton-carrito">Agregar üõí</button>
        </div>

        <div class="producto">
          <img src="electrodomesticos/electro5.jpg" alt="L√°mpara LED USB" loading="lazy">
          <h3>L√°mpara LED USB</h3>
          <p class="precio">üíµ $6</p>
          <button class="boton-carrito">Agregar üõí</button>
        </div>

        <div class="producto">
          <img src="electrodomesticos/electro6.jpg" alt="Arrocera SACO 1.8L" loading="lazy">
          <h3>Arrocera SACO 1.8L (700W)</h3>
          <p class="precio">üíµ $32</p>
          <button class="boton-carrito">Agregar üõí</button>
        </div>

        <div class="producto">
          <img src="electrodomesticos/electro7.jpg" alt="Olla de Presi√≥n SACO 7L" loading="lazy">
          <h3>Olla de Presi√≥n SACO 7L</h3>
          <p class="precio">üíµ $55</p>
          <button class="boton-carrito">Agregar üõí</button>
        </div>

        <div class="producto agotado">
          <img src="electrodomesticos/electro8.jpg" alt="Lavadora Autom√°tica ROYAL" loading="lazy">
          <h3>Lavadora Autom√°tica ROYAL</h3>
          <p class="precio">üíµ $210</p>
          <button disabled class="boton-carrito">No disponible</button>
        </div>

        <div class="producto">
          <img src="electrodomesticos/electro9.jpg" alt="Air Fryer MILEXUS ML-AF-900" loading="lazy">
          <h3>Freidora de Aire MILEXUS ML-AF-900</h3>
          <p class="precio">üíµ $58</p>
          <button class="boton-carrito">Agregar üõí</button>
        </div>
      </div>
    </section>

    <!-- Combo y Remesa -->
    <section id="combo" class="seccion-productos" data-categoria="ComboRemesa">
      <h2 class="titulo-oro">Combo y Remesa</h2>
      <div class="galeria">
        <div class="producto">
          <img src="combo/1.jpg" alt="Mueble L1" loading="lazy">
          <h3>Mueble en L de Lujo</h3>
          <p>‚ú® Confort y elegancia que transforman tu sala.</p>
          <p class="precio">üí∞ $195000</p>
          <button class="boton-carrito">Agregar üõí</button>
        </div>

        <div class="producto">
          <img src="combo/2.jpg" alt="Mueble L2" loading="lazy">
          <h3>Mueble en L de Lujo capitoneado</h3>
          <p class="precio">üí∞ $210000</p>
          <button class="boton-carrito">Agregar üõí</button>
        </div>

        <!-- m√°s productos... (el resto puede seguir la misma estructura) -->
      </div>
    </section>

    <!-- Camas / Muebles -->
    <section id="camas" class="seccion-productos" data-categoria="Muebles">
      <h2 class="titulo-oro">üõèÔ∏è Muebles del hogar</h2>
      <div class="galeria">
        <!-- Ejemplo: producto con selector de tama√±o/precio -->
        <div class="producto">
          <img src="camas/cama1.jpg" alt="Cama Moderna 1" loading="lazy">
          <h3>Cama Moderna 1</h3>
          <p>Disponible en varios tama√±os</p>
          <select class="selector-precio" id="cama1-tamano">
            <option value="165000">3/4(1.90 x 1.20) - $165,000</option>
            <option value="170000">Camara(1.90 x 1.35) - $170,000</option>
            <option value="180000">Queen(1.90/2 x 1.60) - $180,000</option>
            <option value="190000">King(2 x 2) - $190,000</option>
          </select>
          <button class="boton-carrito">üõí Agregar al carrito</button>
        </div>

        <!-- Agrega m√°s camas siguiendo el patr√≥n: si hay select => toma su valor -->
      </div>
    </section>

    <!-- Contacto (simple) -->
    <section id="contacto" class="seccion-productos">
      <h2 class="titulo-oro">Contacto</h2>
      <p>Escr√≠benos para m√°s informaci√≥n: <a href="mailto:ventas@primeramano.com">ventas@primeramano.com</a></p>
    </section>
  </main>

  <!-- Bot√≥n flotante para abrir/ocultar carrito -->
  <button id="cartToggle" class="cart-toggle" title="Abrir carrito">üõí</button>

  <!-- Panel del carrito -->
  <aside id="carrito-panel" aria-live="polite" aria-label="Carrito de compras">
    <h2>Tu carrito <span id="toggle-icon">üîº</span></h2>
    <ul id="lista-carrito"></ul>
    <div id="total">Total: $0</div>
    <div class="panel-actions">
      <button class="btn-vaciar" id="vaciar-btn">Vaciar</button>
      <button class="btn-whatsapp" id="whatsapp-btn">Enviar WhatsApp</button>
    </div>
  </aside>

  <footer>
    <p>¬© Primera Mano ‚Äî Dise√±o y cat√°logo</p>
  </footer>

  <!-- JavaScript: carrito robusto y env√≠o WhatsApp -->
  <script>
    /* ---------- Estado y persistencia ---------- */
    let carrito = JSON.parse(localStorage.getItem("carrito")) || [];

    function guardarCarrito(){
      localStorage.setItem("carrito", JSON.stringify(carrito));
    }

    function formatNumber(n){
      try { return Number(n).toLocaleString(); } catch(e){ return n; }
    }

    /* ---------- Detectar productos y escuchar botones ---------- */
    function initProductButtons(){
      // Selecciona todos los botones dentro de tarjetas .producto que no est√©n deshabilitados
      const botones = document.querySelectorAll('.producto .boton-carrito');
      botones.forEach(btn => {
        // evitar doble enlace: si ya tiene data-bound, saltar
        if (btn.dataset.bound === "1") return;
        btn.addEventListener('click', (ev) => {
          ev.preventDefault();
          const productCard = btn.closest('.producto');
          if (!productCard) return;

          // obtener nombre
          let nombreEl = productCard.querySelector('h3');
          let nombre = nombreEl ? nombreEl.textContent.trim() : "Producto";

          // si tiene select, usar su valor/tama√±o; si no, intentar parsear .precio
          const select = productCard.querySelector('select');
          let precio = 0;
          let tamano = "";
          if (select){
            precio = Number(select.value) || 0;
            tamano = select.options[select.selectedIndex]?.text || "";
          } else {
            // intentar leer elemento con clase .precio con n√∫meros dentro
            const precioEl = productCard.querySelector('.precio');
            if (precioEl){
              // buscar d√≠gitos dentro del texto
              const digits = precioEl.textContent.replace(/[^\d.]/g,'');
              precio = Number(digits) || 0;
            } else {
              // si no hay precio visible, fallback a 0
              precio = 0;
            }
            tamano = tamano || "√önico modelo";
          }

          // categor√≠a: buscar la secci√≥n ancestro con data-categoria o id
          let section = productCard.closest('section');
          let categoria = "General";
          if (section){
            categoria = section.dataset.categoria || section.id || "General";
          }

          agregarAlCarrito({ nombre, tamano, precio, categoria });
        });
        btn.dataset.bound = "1";
      });
    }

    /* ---------- Manipulaci√≥n del carrito ---------- */
    function agregarAlCarrito(item){
      // item: {nombre, tamano, precio, categoria}
      if (!item || !item.nombre) return;
      item.precio = Number(item.precio) || 0;
      carrito.push(item);
      guardarCarrito();
      actualizarCarrito();
      // feedback breve
      const original = document.getElementById('cartToggle');
      original.animate([{ transform: 'scale(1)' }, { transform: 'scale(1.06)' }, { transform: 'scale(1)' }], { duration: 300 });
    }

    function actualizarCarrito(){
      const lista = document.getElementById('lista-carrito');
      const totalDiv = document.getElementById('total');
      lista.innerHTML = "";
      let total = 0;

      carrito.forEach((item, idx) => {
        const li = document.createElement('li');
        li.innerHTML = `<div style="flex:1">
                          <strong>${escapeHtml(item.nombre)}</strong><br>
                          <small>${escapeHtml(item.tamano)} ‚Ä¢ ${escapeHtml(item.categoria)}</small>
                        </div>
                        <div style="text-align:right; margin-left:8px;">
                          <span>$${formatNumber(item.precio)}</span>
                          <br>
                          <button title="Eliminar" data-idx="${idx}">‚ùå</button>
                        </div>`;
        // eliminar handler
        li.querySelector('button').addEventListener('click', () => eliminarDelCarrito(idx));
        lista.appendChild(li);
        total += Number(item.precio) || 0;
      });

      totalDiv.textContent = `Total: $${formatNumber(total)}`;
    }

    function eliminarDelCarrito(index){
      if (index < 0 || index >= carrito.length) return;
      carrito.splice(index, 1);
      guardarCarrito();
      actualizarCarrito();
    }

    function vaciarCarrito(){
      if (!confirm("¬øVaciar todo el carrito?")) return;
      carrito = [];
      guardarCarrito();
      actualizarCarrito();
    }

    /* ---------- utilidades ---------- */
    function escapeHtml(str){
      if (!str) return "";
      return String(str).replace(/[&<>"']/g, function(m){ return {'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m]; });
    }

    function normalizeText(str = ""){
      return str.toString().normalize("NFD").replace(/[\u0300-\u036f]/g,"").trim().toLowerCase();
    }
    function onlyDigits(str = ""){
      return str.toString().replace(/\D/g,'');
    }

    /* ---------- Enviar por WhatsApp ---------- */
    function enviarWhatsApp(defaultCountry = "53"){
      if (!Array.isArray(carrito) || carrito.length === 0){
        alert("Tu carrito est√° vac√≠o.");
        return;
      }

      let mensaje = "üõãÔ∏è *Pedido desde el Cat√°logo Primera Mano:*\n\n";
      carrito.forEach(item => {
        mensaje += `‚Ä¢ ${item.nombre} - ${item.tamano || ""} - $${formatNumber(item.precio)}\n`;
      });
      const total = carrito.reduce((acc, it) => acc + (Number(it.precio) || 0), 0);
      mensaje += `\nüí∞ *Total:* $${formatNumber(total)}\n\nüìû Enviado desde el cat√°logo web.`;

      // categor√≠a principal: usar la del primer producto, normalizada
      const rawCategoria = carrito[0].categoria || "General";
      const categoria = normalizeText(rawCategoria);

      const mapaNumeros = {
        "electrodomesticos": "5354843139",
        "electrodom√©sticos": "5354843139",
        "muebles": "53575716",
        "camas": "53575716",
        "comboremesa": "54843139",
        "combo": "54843139",
        "general": "5354843139" // fallback
      };

      // buscar match por includes
      let numeroRaw = "";
      for (const key in mapaNumeros){
        if (categoria.includes(normalizeText(key))){
          numeroRaw = mapaNumeros[key];
          break;
        }
      }
      if (!numeroRaw) numeroRaw = mapaNumeros["general"];

      let digits = onlyDigits(numeroRaw);
      if (digits.length <= 8 && defaultCountry) digits = defaultCountry + digits;
      if (digits.length < 8){
        alert("N√∫mero configurado inv√°lido: " + numeroRaw);
        console.warn("N√∫mero inv√°lido tras normalizar:", digits);
        return;
      }

      const url = `https://wa.me/${digits}?text=${encodeURIComponent(mensaje)}`;
      window.open(url, "_blank");
    }

    /* ---------- Toggle carrito UI ---------- */
    function toggleCarritoUI(){
      const panel = document.getElementById('carrito-panel');
      const icon = document.getElementById('toggle-icon');
      if (!panel) return;
      if (panel.style.display === '' || panel.style.display === 'block'){
        // hide
        panel.style.display = 'none';
        icon.textContent = "üîΩ";
      } else {
        panel.style.display = 'block';
        icon.textContent = "üîº";
      }
    }

    /* ---------- Inicializaci√≥n DOM ---------- */
    document.addEventListener('DOMContentLoaded', () => {
      // asegurar que panel sea visible inicialmente (compacto)
      const panel = document.getElementById('carrito-panel');
      if (panel) panel.style.display = 'block';

      // listeners UI
      document.getElementById('cartToggle').addEventListener('click', () => {
        const panel = document.getElementById('carrito-panel');
        // alternar visibilidad
        panel.style.display = (panel.style.display === 'none') ? 'block' : 'none';
      });

      document.getElementById('vaciar-btn').addEventListener('click', vaciarCarrito);
      document.getElementById('whatsapp-btn').addEventListener('click', () => enviarWhatsApp('53'));

      // Init product buttons (attach listeners)
      initProductButtons();

      // Si agregas productos din√°micamente luego, vuelve a llamar initProductButtons()

      // Cargar carrito guardado y renderizar
      actualizarCarrito();
    });
  </script>
</body>
</html>
